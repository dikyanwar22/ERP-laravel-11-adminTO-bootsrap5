</div><!-- /.content-wrapper -->

<footer class="main-footer">
  <div class="pull-right hidden-xs">
    <b>Version</b> 2.3.0
  </div>
  <strong>Copyright &copy; 2014-2015 <a href="http://almsaeedstudio.com">Almsaeed Studio</a>.</strong> All rights reserved.
</footer>

<!-- Control Sidebar -->
<aside class="control-sidebar control-sidebar-dark">
  <!-- Create the tabs -->
  <ul class="nav nav-tabs nav-justified control-sidebar-tabs">
    <li><a href="#control-sidebar-home-tab" data-toggle="tab"><i class="fa fa-home"></i></a></li>

    <li><a href="#control-sidebar-settings-tab" data-toggle="tab"><i class="fa fa-gears"></i></a></li>
  </ul>
  <!-- Tab panes -->
  <div class="tab-content">
    <!-- Home tab content -->
    <div class="tab-pane" id="control-sidebar-home-tab">
      <h3 class="control-sidebar-heading">Recent Activity</h3>
      <ul class="control-sidebar-menu">
        <li>
          <a href="javascript::;">
            <i class="menu-icon fa fa-birthday-cake bg-red"></i>
            <div class="menu-info">
              <h4 class="control-sidebar-subheading">Langdon Birthday</h4>
              <p>Will be 23 on April 24th</p>
            </div>
          </a>
        </li>
        <li>
          <a href="javascript::;">
            <i class="menu-icon fa fa-user bg-yellow"></i>
            <div class="menu-info">
              <h4 class="control-sidebar-subheading">Frodo Updated His Profile</h4>
              <p>New phone +1(800)555-1234</p>
            </div>
          </a>
        </li>
        <li>
          <a href="javascript::;">
            <i class="menu-icon fa fa-envelope-o bg-light-blue"></i>
            <div class="menu-info">
              <h4 class="control-sidebar-subheading">Nora Joined Mailing List</h4>
              <p>nora@example.com</p>
            </div>
          </a>
        </li>
        <li>
          <a href="javascript::;">
            <i class="menu-icon fa fa-file-code-o bg-green"></i>
            <div class="menu-info">
              <h4 class="control-sidebar-subheading">Cron Job 254 Executed</h4>
              <p>Execution time 5 seconds</p>
            </div>
          </a>
        </li>
      </ul><!-- /.control-sidebar-menu -->

      <h3 class="control-sidebar-heading">Tasks Progress</h3>
      <ul class="control-sidebar-menu">
        <li>
          <a href="javascript::;">
            <h4 class="control-sidebar-subheading">
              Custom Template Design
              <span class="label label-danger pull-right">70%</span>
            </h4>
            <div class="progress progress-xxs">
              <div class="progress-bar progress-bar-danger" style="width: 70%"></div>
            </div>
          </a>
        </li>
        <li>
          <a href="javascript::;">
            <h4 class="control-sidebar-subheading">
              Update Resume
              <span class="label label-success pull-right">95%</span>
            </h4>
            <div class="progress progress-xxs">
              <div class="progress-bar progress-bar-success" style="width: 95%"></div>
            </div>
          </a>
        </li>
        <li>
          <a href="javascript::;">
            <h4 class="control-sidebar-subheading">
              Laravel Integration
              <span class="label label-warning pull-right">50%</span>
            </h4>
            <div class="progress progress-xxs">
              <div class="progress-bar progress-bar-warning" style="width: 50%"></div>
            </div>
          </a>
        </li>
        <li>
          <a href="javascript::;">
            <h4 class="control-sidebar-subheading">
              Back End Framework
              <span class="label label-primary pull-right">68%</span>
            </h4>
            <div class="progress progress-xxs">
              <div class="progress-bar progress-bar-primary" style="width: 68%"></div>
            </div>
          </a>
        </li>
      </ul><!-- /.control-sidebar-menu -->

    </div><!-- /.tab-pane -->
    <!-- Stats tab content -->
    <div class="tab-pane" id="control-sidebar-stats-tab">Stats Tab Content</div><!-- /.tab-pane -->
    <!-- Settings tab content -->
    <div class="tab-pane" id="control-sidebar-settings-tab">
      <form method="post">
        <h3 class="control-sidebar-heading">General Settings</h3>
        <div class="form-group">
          <label class="control-sidebar-subheading">
            Report panel usage
            <input type="checkbox" class="pull-right" checked>
          </label>
          <p>
            Some information about this general settings option
          </p>
        </div><!-- /.form-group -->

        <div class="form-group">
          <label class="control-sidebar-subheading">
            Allow mail redirect
            <input type="checkbox" class="pull-right" checked>
          </label>
          <p>
            Other sets of options are available
          </p>
        </div><!-- /.form-group -->

        <div class="form-group">
          <label class="control-sidebar-subheading">
            Expose author name in posts
            <input type="checkbox" class="pull-right" checked>
          </label>
          <p>
            Allow the user to show his name in blog posts
          </p>
        </div><!-- /.form-group -->

        <h3 class="control-sidebar-heading">Chat Settings</h3>

        <div class="form-group">
          <label class="control-sidebar-subheading">
            Show me as online
            <input type="checkbox" class="pull-right" checked>
          </label>
        </div><!-- /.form-group -->

        <div class="form-group">
          <label class="control-sidebar-subheading">
            Turn off notifications
            <input type="checkbox" class="pull-right">
          </label>
        </div><!-- /.form-group -->

        <div class="form-group">
          <label class="control-sidebar-subheading">
            Delete chat history
            <a href="javascript::;" class="text-red pull-right"><i class="fa fa-trash-o"></i></a>
          </label>
        </div><!-- /.form-group -->
      </form>
    </div><!-- /.tab-pane -->
  </div>
</aside><!-- /.control-sidebar -->
<!-- Add the sidebar's background. This div must be placed
     immediately after the control sidebar -->
<div class="control-sidebar-bg"></div>
</div><!-- ./wrapper -->

<!-- charbox -->
<div class="chat_box">
<div class="chat_head" style="background: #3c8dbc;">
  <img src="{{asset('assets/icon/bell.png')}}" align="right" style="width:25px; height:25px; margin-bottom: -20px; margin-right: 8px;" border="0">
  <span id="total_help" class="label label-default" style="border-radius: 50px; width: 10px; text-align: center; background-color: #ff0000; color: white; margin-left: 264px; margin-bottom: 5px;"></span>
</div>
<div class="searchBox" style="display: none;">
  <div class="searchBox-inner" align="center" style="border-right: 1px solid #d0d0d0;border-left: 1px solid #d0d0d0;border-top: 1px solid #d0d0d0;">
    <input type="text" id="myInput1" class="span3" style="margin-top: 6px;width: 90%;" onkeyup="myFunction1()" placeholder="Search Support...">
  </div>
</div>
<div class="chat_body" style="display: none;">
  <div class="member_list" style="background: white;border: 1px solid #d0d0d0;">
    <!-- untuk menampilkan data helpdesk -->
      <span id="tampil_helpdesk"></span>
      <!-- untuk menampilkan data helpdesk -->
      </div>
    </div>
  </div>
<!-- chatbox -->

<!-- jQuery 2.1.4 -->
<!-- <script src="{{asset('assets/AdminLTE/plugins/jQuery/jQuery-2.1.4.min.js')}}"></script> -->

<!-- Bootstrap 3.3.5 -->
<script src="{{asset('assets/AdminLTE/bootstrap/js/bootstrap.min.js')}}"></script>
<!-- SlimScroll -->
<script src="{{asset('assets/AdminLTE/plugins/slimScroll/jquery.slimscroll.min.js')}}"></script>
<!-- FastClick -->
<script src="{{asset('assets/AdminLTE/plugins/fastclick/fastclick.min.js')}}"></script>
<!-- AdminLTE App -->
<script src="{{asset('assets/AdminLTE/dist/js/app.min.js')}}"></script>
<!-- AdminLTE for demo purposes -->
<script src="{{asset('assets/AdminLTE/dist/js/demo.js')}}"></script>

<meta name="csrf-token" content="{{csrf_token()}}">

<!-- chatbox -->
<script type="text/javascript">
$.ajaxSetup({
  headers: {
    'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
  }
});

show_helpdesk();
function show_helpdesk() {
  $.ajax({
  url: "{{ url('Helpdesk/helpdesk_in') }}",
  method: 'GET',
  dataType: 'JSON',
  success: function(response) {
    var hitung = response.data.length;
    var elemenHTML = '<ul class="list-unstyled" id="style-5">';
    for (var i = 0; i < hitung; i++) {
      elemenHTML += '<li class="left clearfix" style="padding: 10px 10px; border-bottom: 1px solid #d0d0d0; position: relative;">';
      elemenHTML += '<a href="' + response.data[i].url + '" target="_blank" style="display: block;">';
      
      elemenHTML += '<small style="color: #999999; font-size: 10px; position: absolute; top: 5px; right: 10px;">';
      elemenHTML += '<i class="fa fa-clock-o"></i> ' + response.data[i].waktu + '</small>';

      elemenHTML += '<div style="display: flex; align-items: center; margin-top: 15px;">';
      elemenHTML += '<img src="' + response.data[i].image + '" class="img-circle" alt="User Image" style="width: 40px; height: 40px; margin-right: 10px;">';

      elemenHTML += '<div>';
      elemenHTML += '<h4 style="margin: 0; color: #444444; font-size: 15px;">' + response.data[i].name + '</h4>';
      elemenHTML += '<p style="margin: 0; font-size: 12px; color: #888888;">' + response.data[i].helpdesk + '</p>';
      elemenHTML += '</div>';

      elemenHTML += '</div>'; 
      elemenHTML += '</a>';
      elemenHTML += '</li>';
    }
    elemenHTML += '</ul>';
    $('#tampil_helpdesk').html(elemenHTML);
    $('#total_help').text(hitung);
  },
  error: function(xhr, status, error) {
    console.error("AJAX Error: ", error);
  }
});
}

function myFunction1() {
  var input, filter, ul, li, a, i;
  input = document.getElementById('myInput1');
  filter = input.value.toUpperCase();
  ul = document.getElementById("style-5");
  li = ul.getElementsByTagName('li');
  for (i = 0; i < li.length; i++) {
    a = li[i].getElementsByTagName("a")[0];
    if (a.innerHTML.toUpperCase().indexOf(filter) > -1) {
      li[i].style.display = "";
    } else {
      li[i].style.display = "none";
    }
  }
}
</script>

<script type="text/javascript">
$.ajaxSetup({
  headers: {
    'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
  }
});

tampil_modul();
function tampil_modul() {
    $.ajax({
        url: "{{ url('tampil_modul') }}",
        method: 'GET',
        dataType: 'JSON',
        success: function(response) {
            var elemenHTML = `
                <div class="subnavbar">
                    <div class="subnavbar-inner">
                        <div class="container">
                            <ul class="mainnav">
            `;
            
            response.forEach(function(modul) {
                var page = window.location.pathname.split('/')[1];
                var url_modul = modul.uri;
                var isActive = page === url_modul;
                var activeClass = isActive ? 'active' : '';
                var activeStyle = isActive ? 'style="background-color: lightblue; color: #FF8C00"' : '';
                var iconStyle = isActive ? 'style="color: #FF8C00"' : '';
                
                elemenHTML += `
                    <li class="${activeClass}" ${activeStyle}>
                        <a href="{{ url('') }}/${url_modul}">
                            <i class="${modul.icon}" ${iconStyle}></i>
                            <span ${iconStyle}>${modul.modul}</span>
                        </a>
                    </li>
                `;
            });
            
            elemenHTML += '<li>&nbsp;</li></ul></div></div></div>';
            
            $('#tampil_modul').append(elemenHTML);
        }
    });
}

$(document).ready(function() {
  loadMenu();
});

// Fungsi untuk memuat menu
function loadMenu() {
  const uri_name = window.location.pathname.split('/')[1]; 
  if (!uri_name) {
    console.error('Error: Invalid uri_name');
    return;
  }

  $.ajax({
    url: '{{ url('all_menu') }}',
    method: 'POST',
    dataType: 'JSON',
    data: {
      nama_modul: uri_name,
    },
    success: function (response) {
      if (!response || !response.menu_tunggal) {
        console.error('Error: Response format invalid');
        return;
      }

      let v_html = '<ul class="sidebar-menu">';
      response.menu_tunggal.forEach(menuItem => {
        const active_link = window.location.pathname.includes(menuItem.class)
        ? 'style="background-color: lightblue !important; font-weight: bold;"' : '';
        const active_text_menu = window.location.pathname.includes(menuItem.class)
        ? 'style="color: #FF8C00;"' : '';
        const url = `${menuItem.folder}/${menuItem.class}`;

        if (menuItem.tipe === 'menu') {
          v_html += `
            <li ${active_link}>
              <a class="nav-link" href="{{ url('') }}/${url}">
                <i class="${menuItem.icon}" ${active_text_menu}></i>
                <span ${active_text_menu}>&nbsp;&nbsp;${menuItem.menu}</span>
              </a>
            </li>
          `;
        }

        if (menuItem.tipe === 'dropdown') {
          v_html += loadSubMenu(menuItem);
        }
      });

      v_html += '</ul>';

      $('#all_menu').html(v_html);
    },
    error: function (error) {
      console.error('Error:', error);
    },
  });
}

// Fungsi untuk memuat submenu
function loadSubMenu(menuItem) {
  var link_dropdown = window.location.pathname.split('/')[2];
  var isActive = menuItem.class == link_dropdown;
  var itemClass = isActive ? 'active' : '';

  var submenuHTML = `
    <li class="treeview ${itemClass}">
      <a href="#">
        <i class="${menuItem.icon}"></i> <span>${menuItem.menu}</span>
        <i class="fa fa-angle-left pull-right"></i>
      </a>
      <ul class="treeview-menu">
  `;

  $.ajax({
    url: '{{ url('modul_sub_menu') }}',
    method: 'POST',
    dataType: 'JSON',
    data: { menu_id: menuItem.id },
    async: false,
    success: function(response_data) {
      response_data.forEach(subMenuItem => {
        submenuHTML += generateSubMenuHTML(subMenuItem, menuItem);
      });
    },
    error: function(error) {
      console.error('Error:', error);
    }
  });

  submenuHTML += `</ul></li>`;
  return submenuHTML;
}

function generateSubMenuHTML(subMenuItem, menuItem) {
  var link_sub = window.location.pathname.split('/')[3];
  var isActive = link_sub == subMenuItem.uri_sub;

  var active_link_sub = isActive ? 'lightblue' : '';
  var active_text_color = isActive ? '#FF8C00' : '';
  var sizeText = isActive ? 'font-weight: bold' : '';
  var iconColor = isActive ? 'color: #FF8C00;' : '';

  var count_notif = subMenuItem.total;
  var total_notif = count_notif > 0 ? '(' + count_notif + ')' : '';

  var url = subMenuItem.folder + '/' + subMenuItem.class + '/' + subMenuItem.function;

  var submenuHTML = '';
  submenuHTML += '<li style="margin-left: 0%;">';
  submenuHTML += '<a style="background-color: '+active_link_sub+'; margin-right: 0%; '+sizeText+'; color: '+active_text_color+'" href="{{ url('') }}/' + url + '">';
  submenuHTML += '<i class="' + subMenuItem.icon_sub + '" style="'+iconColor+'"></i>&nbsp;&nbsp;' + subMenuItem.sub_menu + ' ' + total_notif;
  submenuHTML += '</a>';
  submenuHTML += '</li>';

  return submenuHTML;
}

</script>

<!-- chatbox -->
<script type="text/javascript">
$('.chat_head').click(function(){
  $('.chat_body').slideToggle('slow');
  $('.searchBox').slideToggle('slow');
  $('.msg_box').hide('slow');
});

$('.msg_head').click(function(){
  $('.msg_wrap').slideToggle('slow');
});

$('.msg_box').hide();
$('.chat_body').hide();
$('.searchBox').hide();
</script>
<!-- chatbox -->

</body>
</html>
